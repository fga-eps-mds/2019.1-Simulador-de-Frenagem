#!/bin/sh

gitFolder="$(git rev-parse --show-toplevel)"
imageName="unbrake_frontend"  # compose project name + service name
frontendFolder="$gitFolder/unbrake-frontend"
hookName="$(basename $0)"

git diff --name-only --cached > /tmp/unbrake_staged

# git folder volume must be /app/.git
sudo docker run \
    -t \
    -v "$gitFolder/.git:/app/.git" \
    -v "$frontendFolder/src:/app/frontend/src" \
    --rm \
    --entrypoint '/app/frontend/scripts/run_container_hook' \
    $imageName \
	$hookName $@

didBrake=$?
for file in $(cat /tmp/unbrake_staged); do git add $file; done
rm -rf /tmp/unbrake_staged
exit $didBrake
